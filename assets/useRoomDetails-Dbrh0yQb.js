import{_ as K,p as A,r as $,s as V,w as X,o as J,c as U,b as N,d as C,l as Y,F as Q,y as R,g as L,m as Z,u as ee}from"./index-CHcuzhol.js";function te(){const l=new Map;function v(){l.clear()}function h(s){if(!s)return;const r=`${s}::`;for(const c of l.keys())c.startsWith(r)&&l.delete(c)}function b(s){return new Promise((r,c)=>{const n=new Image;n.crossOrigin="anonymous",n.decoding="async",n.onload=()=>r(n),n.onerror=e=>c(new Error("Failed to load image: "+s)),n.src=s})}function d(s){const c=document.createElement("canvas");c.width=256,c.height=256;const n=c.getContext("2d",{willReadFrequently:!0});return n.drawImage(s,0,0,256,256),{canvas:c,ctx:n}}function g(s){if(!s)return"#DDDDDD";let r=String(s).trim();return r[0]!=="#"&&(r="#"+r),r.length===4&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),/^#([0-9a-fA-F]{6})$/.test(r)?r.toUpperCase():"#DDDDDD"}function x(s){const r=parseInt(s.slice(1),16);return{r:r>>16&255,g:r>>8&255,b:r&255}}function p(s,r,c,n,e){const a=1-e;return{r:Math.round(s*a+n.r*e),g:Math.round(r*a+n.g*e),b:Math.round(c*a+n.b*e)}}function f(s,r,c){const{width:n,height:e,data:a}=s;let t=!1;const u=new ImageData(n,e),i=u.data,o=0,m=255,w=0,z=Math.max(0,Number.isFinite(r)?r:0);for(let k=0;k<a.length;k+=4){const I=a[k],j=a[k+1],S=a[k+2],F=a[k+3];if(F===0)continue;const P=I-o,q=j-m,W=S-w,B=Math.sqrt(P*P+q*q+W*W);let O=0;if(I===0&&j===255&&S===0&&(t=!0),z===0?I===0&&j===255&&S===0&&(O=1):B<=z&&(O=1-B/z),O>0){const G=Math.round(F*O);i[k]=255,i[k+1]=255,i[k+2]=255,i[k+3]=G;const T=p(I,j,S,c,O);a[k]=T.r,a[k+1]=T.g,a[k+2]=T.b}}return{foundGreen:t,editedImageData:s,maskImageData:t?u:null}}function y(s){const r=document.createElement("canvas");return r.width=s.width,r.height=s.height,r.getContext("2d").putImageData(s,0,0),r.toDataURL("image/png")}function D(s){const{canvas:r,ctx:c}=d(s);return c.getImageData(0,0,r.width,r.height)}function M(s,r,c=0,n=!0,e="#DDDDDD"){if(!s||!r)return Promise.reject(new Error("getPenImages(roomCode, spriteSrc) requires both parameters."));const a=g(e),t=`${s}::${r}::${c}::${a}`;if(l.has(t))return l.get(t);const u=(async()=>{const i=await b(r),{canvas:o,ctx:m}=d(i),w=m.getImageData(0,0,o.width,o.height),z=x(a);let{foundGreen:k,editedImageData:I,maskImageData:j}=f(w,c,z),S=!1;n&&!j&&(j=D(await b("/img/default_mask.png")),S=!0),m.putImageData(I,0,0);const F=o.toDataURL("image/png"),P=j?y(j):null;return{maskingMode:!!k||S,penImage:F,penMask:P}})().catch(i=>{throw l.delete(t),i});return l.set(t,u),u}return{getPenImages:M,clearPenMaskCache:v,clearRoomCache:h}}var E={exports:{}},ae=E.exports,H;function ne(){return H||(H=1,(function(l,v){(function(h,b){l.exports=b()})(ae,(()=>{return h={380:(d,g,x)=>{function p(n){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(n)}function f(n){return(function(e){if(Array.isArray(e))return y(e)})(n)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(n)||(function(e,a){if(e){if(typeof e=="string")return y(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?y(e,a):void 0}})(n)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function y(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,t=new Array(e);a<e;a++)t[a]=n[a];return t}function D(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),a.push.apply(a,t)}return a}function M(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?D(Object(a),!0).forEach((function(t){s(n,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))}))}return n}function s(n,e,a){return(e=(function(t){var u=(function(i,o){if(p(i)!=="object"||i===null)return i;var m=i[Symbol.toPrimitive];if(m!==void 0){var w=m.call(i,"string");if(p(w)!=="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)})(t);return p(u)==="symbol"?u:String(u)})(e))in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var r=x(554);function c(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a={placeholder:"*",caseSensitive:!1,wholeWordsOnly:!0,exceptions:[],keepFirstAndLastChar:!1,customReplacement:null,replacePartialWords:!1,includePunctuation:!1,minimumWordLength:1,customMatch:null,customBadWords:[]},t=M(M({},a),e),u=[].concat(f(r),f(t.customBadWords)).map((function(o){return o.replace(/\*/g,"\\w+")})),i=new RegExp(u.join("|"),"g");return t.caseSensitive||(i=new RegExp(u.join("|"),"gi")),t.wholeWordsOnly&&(i=new RegExp("\\b(".concat(u.join("|"),")\\b"),"gi")),t.replacePartialWords&&(i=new RegExp(u.join("|"),"gi")),n.replace(i,(function(o){if(o.length<t.minimumWordLength||typeof t.customMatch=="function"&&!t.customMatch(o)||t.exceptions.includes(o.toLowerCase()))return o;if(typeof t.customReplacement=="function")return t.customReplacement(o);if(t.keepFirstAndLastChar)return"".concat(o[0]).concat(t.placeholder.repeat(o.length-2)).concat(o[o.length-1]);var m=t.placeholder.repeat(o.length);if(t.includePunctuation){var w=o[0],z=o[o.length-1];w.match(/[^\w\s]/)&&(m="".concat(w).concat(m.substring(1))),z.match(/[^\w\s]/)&&(m="".concat(m.substring(0,m.length-1)).concat(z))}return m}))}d.exports={clean:c,isProfane:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=c(n,e);return a!==n}}},554:d=>{d.exports=JSON.parse('["ahole","anus","ash0le","ash0les","asholes","ass","Ass Monkey","Assface","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","Biatch","bitch","bitches","Blow Job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","Carpet Muncher","cawk","cawks","Clit","cnts","cntz","cock","cockhead","cock-head","cocks","CockSucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagg0t","fagit","fags","fagz","faig","faigs","fart","flipping the bird","fuck","fucker","fuckin","fucking","fucks","Fudge Packer","fuk","Fukah","Fuken","fuker","Fukin","Fukk","Fukkah","Fukken","Fukker","Fukkin","g00k","God-damned","h00r","h0ar","h0re","hells","hoar","hoor","hoore","jackoff","jap","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","Lezzian","Lipshits","Lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","Motha Fucker","Motha Fuker","Motha Fukkah","Motha Fukker","Mother Fucker","Mother Fukah","Mother Fuker","Mother Fukkah","Mother Fukker","mother-fucker","Mutha Fucker","Mutha Fukah","Mutha Fuker","Mutha Fukkah","Mutha Fukker","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","packi","packie","packy","paki","pakie","paky","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","Phuc","Phuck","Phuk","Phuker","Phukker","polac","polack","polak","Poonani","pr1c","pr1ck","pr1k","pusse","pussee","pussy","puuke","puuker","qweir","recktum","rectum","retard","sadist","scank","schlong","screwing","semen","sex","sexy","Sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","Shitty","Shity","shitz","Shyt","Shyte","Shytty","Shyty","skanck","skank","skankee","skankey","skanks","Skanky","slag","slut","sluts","Slutty","slutz","son-of-a-bitch","tit","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","w0p","wh00r","wh0re","whore","xrated","xxx","b!+ch","bitch","blowjob","clit","arschloch","fuck","shit","ass","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cock","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat*","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","*damn","*dyke","*fuck*","*shit*","@$$","amcik","andskota","arse*","assrammer","ayir","bi7ch","bitch*","bollock*","breasts","butt-pirate","cabron","cazzo","chraa","chuj","Cock*","cunt*","d4mn","daygo","dego","dick*","dike*","dupa","dziwka","ejackulate","Ekrem*","Ekto","enculer","faen","fag*","fanculo","fanny","feces","feg","Felcher","ficken","fitt*","Flikker","foreskin","Fotze","Fu*","fuk*","futkretzn","gook","guiena","h0r","h4x0r","hell","helvete","hoer*","honkey","Huevon","hui","injun","jizz","kanker*","kike","klootzak","kraut","knulle","kuk","kuksuger","Kurac","kurwa","kusi*","kyrpa*","lesbo","mamhoon","masturbat*","merd*","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger*","orospu","paska*","perse","picka","pierdol*","pillu*","pimmel","piss*","pizda","poontsee","poop","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef*","rautenberg","schaffer","scheiss*","schlampe","schmuck","screw","sh!t*","sharmuta","sharmute","shipal","shiz","skribz","skurwysyn","sphencter","spic","spierdalaj","splooge","suka","b00b*","testicle*","titt*","twat","vittu","wank*","wetback*","wichser","wop*","yed","zabourah"]')}},b={},(function d(g){var x=b[g];if(x!==void 0)return x.exports;var p=b[g]={exports:{}};return h[g](p,p.exports,d),p.exports})(380);var h,b}))})(E)),E.exports}var re=ne();function oe(l){if(!l||typeof l!="string")return l;let v=re.clean(l);const h=16;return v.length>h&&(v=v.slice(0,h)),v.replace(/\*/g,"â–ˆ")}const se=["src"],ie={class:"glow-wrapper blur20"},ce={class:"glow-wrapper blur3"},ue={__name:"PenLight",props:{roomDetails:{type:Object,required:!0},color:{type:String,required:!0},opacity:{type:Number,default:1},penTransform:{type:Object,required:!0},penSize:{type:Number,default:256,required:!1},nickName:{type:String,default:"anonymous",required:!1},smoothMotion:{type:Boolean,default:!1,required:!1}},setup(l,{expose:v}){const h=l,b=A(()=>oe(h.nickName)),d=$(!0),g=$(!1),{getPenImages:x}=te(),p=$(null),f=V(null),y=$(null);let D="",M=null;X(()=>h.color,e=>{d.value=!1,setTimeout(()=>{d.value=!0},100)},{immediate:!0});const s=A(()=>{const e=h.roomDetails?.penlightSprite;return e?`${e}`:"/img/default_light.png"}),r=A(()=>{const e=h.penSize,a=h.penTransform.x,t=h.penTransform.y,u=h.penTransform.theta;return{left:`${a}px`,top:`${t}px`,width:`${e}px`,height:`${e}px`,transform:`translate(-50%, -80%) rotate(${u}deg)`,opacity:h.opacity,"--beam-color":`#${h.color}`}});J(async()=>{const e=h.roomDetails.code;f.value=await x(e,s.value,255),g.value=f.value?.maskingMode||!1,g.value&&f.value?.penMask&&(y.value=new Image,y.value.src=f.value.penMask,await new Promise((a,t)=>{y.value.onload=()=>a(!0),y.value.onerror=()=>t(!1)}))});function c(e,a){if(a===D&&M!=null)return M;if(!(e instanceof HTMLImageElement))throw new TypeError("colorImage: expected HTMLImageElement");if(!e.complete||e.naturalWidth===0)throw new Error("colorImage: image not loaded");const t=e.naturalWidth,u=e.naturalHeight,i=document.createElement("canvas");i.width=t,i.height=u;const o=i.getContext("2d");o.clearRect(0,0,t,u),o.drawImage(e,0,0,t,u),o.globalCompositeOperation="source-in",o.fillStyle=a,o.fillRect(0,0,t,u),o.globalCompositeOperation="source-over";const m=new Image;return m.src=i.toDataURL(),M=m,D=a,m}function n(e){if(!p.value)return;const a=p.value,t=a.getBoundingClientRect(),i=window.getComputedStyle(a).transform,{penSize:o,color:m}=h;if(y.value==null)return;const w=c(y.value,`#${m}`);if(!i||i==="none"){e.strokeStyle=`#${m}`,e.lineWidth=1,e.strokeRect(t.left,t.top,t.width,t.height);return}const z=i.match(/^matrix\((.+)\)$/);if(!z){console.warn("No valid matrix:",i),e.strokeStyle=`#${m}`,e.strokeRect(t.left,t.top,t.width,t.height);return}const[k,I]=z[1].split(",").map(Number),j=Math.atan2(I,k),S=t.left+t.width/2,F=t.top+t.height/2,P=o/2;w&&w.complete&&(e.save(),e.translate(S,F),e.rotate(j),e.drawImage(w,-P,-P,o,o),e.restore())}return v({drawPenTrail:n}),(e,a)=>(N(),U("div",{ref_key:"rootEl",ref:p,class:L(["pen",{"use-motion-smoothing":l.smoothMotion}]),style:R(r.value),role:"img"},[C("img",{class:"pen-img",src:g.value?f.value.penImage:s.value,alt:"",draggable:"false"},null,8,se),d.value?(N(),U(Q,{key:0},[C("div",ie,[C("div",{class:L(["glow",{"mask-mode":g.value}]),style:R(g.value?{"-webkit-mask-image":`url(${f.value.penMask})`,"mask-image":`url(${f.value.penMask})`}:{})},null,6)]),C("div",ce,[C("div",{class:L(["glow",{"mask-mode":g.value}]),style:R(g.value?{"-webkit-mask-image":`url(${f.value.penMask})`,"mask-image":`url(${f.value.penMask})`}:{})},null,6)])],64)):Y("",!0),C("div",{class:"pen-name",style:R({transform:`translateX(-50%) rotate(${-l.penTransform.theta}deg)`})},Z(b.value),5)],6))}},he=K(ue,[["__scopeId","data-v-70e8bbbd"]]),_=new Map,le="https://dev.api.pen.lighting";async function pe(l=!1,v={}){const b=ee().params.room_code,d=Array.isArray(b)?b[0]:typeof b=="string"?b:void 0;if(!d)return null;const{signal:g,timeoutMs:x=8e3}=v,p=d;if(l&&_.has(p))return _.get(p);const f=new AbortController,y=setTimeout(()=>f.abort(),x);g&&(g.aborted?f.abort():g.addEventListener("abort",()=>f.abort(),{once:!0}));const D=(async()=>{try{const s=await fetch(`${le}/rooms/${encodeURIComponent(d)}`,{headers:{Accept:"application/json"},signal:f.signal});return s.ok?await s.json():null}catch{return null}finally{clearTimeout(y)}})();l&&_.set(p,D);const M=await D;return M===null&&l&&_.delete(p),M}export{he as P,pe as u};
