import{_ as L,b as F,r as H,d as u,w as g,c as i,o as r,e as o,f as R,g as p,v as P,n as B,t as w,a as ne,F as ae,h as ie,i as re,j as ue,k as de,u as ce}from"./index-rzYDIjU6.js";const pe={class:"room-form"},ve={class:"row"},me={class:"field"},fe={key:0,class:"error"},he={class:"row"},Ce={class:"field"},be={key:0,class:"error"},ge={class:"row"},we={class:"field color-field"},_e={class:"hex-preview"},ye={class:"row"},ke={class:"field"},xe=["value"],Se={class:"row"},Re={class:"field"},Pe={class:"swatches"},Ve=["title","onClick"],Ae={key:0,class:"popover"},Ue={key:1,class:"popover"},Me={class:"popover-actions"},Te={key:0,class:"error"},Ie={class:"row"},Ne={class:"field sprite-field"},$e={key:0,class:"preview"},De=["src"],Ee={class:"sprite-actions"},Fe=["disabled"],Be={class:"row"},Le={class:"field"},He={class:"switch"},Oe=["checked"],Ze={class:"row"},je={class:"field"},qe=["value"],ze={class:"row"},Ge={class:"field"},Qe=["value"],We={__name:"RoomForm",props:{modelValue:{type:Object,required:!0},mode:{type:String,default:"edit"}},emits:["update:modelValue"],setup(M,{emit:_}){const f=M,V=_,s=F({get(){return f.modelValue},set(t){V("update:modelValue",t)}}),h=/^#[0-9A-Fa-f]{6}$/,O=/^[0-9a-zA-Z,.! ]+$/,Z=/^[0-9A-Za-z ,.!\-_=+@#$%^&*(){}\[\]|\\:;"'<>,.?/~`]+$/;function T(t){return t===""||typeof t=="string"&&t.length<=64&&O.test(t)}function I(t){return t===""||typeof t=="string"&&t.length<=64&&Z.test(t)}const a=H({name:"",password:"",penColors:""}),C=u(s.value.name??""),b=u(s.value.password??"");g(()=>s.value.name,t=>{t!==C.value&&T(t??"")&&(C.value=t??"")}),g(()=>s.value.password,t=>{t!==b.value&&I(t??"")&&(b.value=t??"")}),g(C,t=>{T(t)?(a.name="",s.value.name=t):a.name="Only 0-9 a-z A-Z , . ! and space; max 64 chars"}),g(b,t=>{I(t)?(a.password="",s.value.password=t):a.password="Invalid characters or length > 64"});const N=F({get(){const t=s.value.themeColor||"";return t?`#${t}`:"#000000"},set(t){const e=(t||"").trim();h.test(e)&&(s.value.themeColor=e.slice(1).toUpperCase())}});function j(t){["hidden","top-left","top-right","bottom-left","bottom-right"].includes(t)&&(s.value.showCode=t)}const v=u(!1),A=u(null),d=u(-1),m=u("#000000");function q(){d.value=-1,m.value="#000000",v.value=!0,re(()=>A.value&&A.value.focus())}function y(){const t=m.value;if(h.test(t)){const e=t.slice(1).toUpperCase();s.value.penColors.includes(e)||s.value.penColors.push(e),a.penColors=""}else a.penColors="Pick a 6-digit hex color";v.value=!1}function k(){v.value=!1}function z(t){d.value=d.value===t?-1:t}function G(t){s.value.penColors.splice(t,1),d.value=-1}function Q(t){m.value=`#${s.value.penColors[t]}`,d.value=-1,v.value=!0,W(()=>{const e=m.value;h.test(e)&&(s.value.penColors[t]=e.slice(1).toUpperCase()),v.value=!1},()=>{v.value=!1})}let x=null;function W(t,e){x&&x();const l=y,n=k;y=()=>{t(),c()},k=()=>{e(),c()};function c(){y=l,k=n,x=null}x=c}const U=u(null);async function X(t){const e=t.target.files&&t.target.files[0];if(!e||e.type!=="image/png")return;const l=await K(e),n=await Y(l,256);n&&(s.value.penlightSprite=n)}function J(){s.value.penlightSprite=null,U.value&&(U.value.value="")}function K(t){return new Promise((e,l)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=l,n.readAsDataURL(t)})}function Y(t,e=256){return new Promise(l=>{const n=new Image;n.onload=()=>{const c=document.createElement("canvas");c.width=e,c.height=e;const S=c.getContext("2d");S.clearRect(0,0,e,e);const $=Math.min(e/n.width,e/n.height),D=Math.round(n.width*$),E=Math.round(n.height*$),le=Math.floor((e-D)/2),se=Math.floor((e-E)/2);S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(n,le,se,D,E),l(c.toDataURL("image/png"))},n.onerror=()=>l(null),n.src=t})}function ee(t){s.value.duplicateUsers=!!t}function te(t){const e=Number(t);if(Number.isFinite(e)){const l=Math.max(1,Math.min(100,Math.trunc(e)));s.value.duplicationThreshold=l}}function oe(t){const e=Number(t);Number.isFinite(e)&&(s.value.maxConcurrent=Math.max(1,Math.trunc(e)))}return(t,e)=>(r(),i("div",pe,[o("div",ve,[e[11]||(e[11]=o("label",{class:"label",for:"name"},"Name",-1)),o("div",me,[R(o("input",{id:"name",type:"text",maxlength:64,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),placeholder:"(optional)",class:B({invalid:!!a.name})},null,2),[[P,C.value]]),a.name?(r(),i("p",fe,w(a.name),1)):p("",!0)])]),o("div",he,[e[13]||(e[13]=o("label",{class:"label",for:"password"},"Password",-1)),o("div",Ce,[R(o("input",{id:"password",type:"text",maxlength:64,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),placeholder:"(optional)",class:B({invalid:!!a.password})},null,2),[[P,b.value]]),e[12]||(e[12]=o("p",{class:"hint"},"alphanumeric + common symbols, max 64",-1)),a.password?(r(),i("p",be,w(a.password),1)):p("",!0)])]),o("div",ge,[e[14]||(e[14]=o("label",{class:"label",for:"themeColor"},"Theme Color",-1)),o("div",we,[R(o("input",{id:"themeColor",type:"color","onUpdate:modelValue":e[2]||(e[2]=l=>N.value=l),"aria-label":"Pick a theme color"},null,512),[[P,N.value]]),o("span",_e,"#"+w(s.value.themeColor||"000000"),1)])]),o("div",ye,[e[16]||(e[16]=o("label",{class:"label",for:"showCode"},"Show Code",-1)),o("div",ke,[o("select",{id:"showCode",value:s.value.showCode,onChange:e[3]||(e[3]=l=>j(l.target.value))},[...e[15]||(e[15]=[ne('<option value="hidden" data-v-a3b2fdb2>Hidden</option><option value="top-left" data-v-a3b2fdb2>Top Left</option><option value="top-right" data-v-a3b2fdb2>Top Right</option><option value="bottom-left" data-v-a3b2fdb2>Bottom Left</option><option value="bottom-right" data-v-a3b2fdb2>Bottom Right</option>',5)])],40,xe)])]),o("div",Se,[e[18]||(e[18]=o("label",{class:"label"},"Pen Colors",-1)),o("div",Re,[o("div",Pe,[(r(!0),i(ae,null,ie(s.value.penColors,(l,n)=>(r(),i("button",{key:n,type:"button",class:"swatch",style:ue({backgroundColor:"#"+l}),title:"#"+l,onClick:c=>z(n)},null,12,Ve))),128)),o("button",{type:"button",class:"add",onClick:q,title:"Add color"},"+"),v.value?(r(),i("div",Ae,[R(o("input",{ref_key:"addPickerRef",ref:A,type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>m.value=l)},null,512),[[P,m.value]]),o("div",{class:"popover-actions"},[o("button",{type:"button",onClick:y},"Confirm"),o("button",{type:"button",class:"ghost",onClick:k},"Cancel")])])):p("",!0),d.value>=0?(r(),i("div",Ue,[o("div",Me,[o("button",{type:"button",class:"danger",onClick:e[5]||(e[5]=l=>G(d.value))},"Delete"),o("button",{type:"button",onClick:e[6]||(e[6]=l=>Q(d.value))},"Recolor"),o("button",{type:"button",class:"ghost",onClick:e[7]||(e[7]=l=>d.value=-1)},"Close")])])):p("",!0)]),e[17]||(e[17]=o("p",{class:"hint"},"Click a swatch to delete or recolor. Values save without the #.",-1)),a.penColors?(r(),i("p",Te,w(a.penColors),1)):p("",!0)])]),o("div",Ie,[e[20]||(e[20]=o("label",{class:"label"},"Penlight Sprite",-1)),o("div",Ne,[s.value.penlightSprite?(r(),i("div",$e,[o("img",{src:s.value.penlightSprite,alt:"Sprite preview"},null,8,De)])):p("",!0),o("div",Ee,[o("input",{ref_key:"fileInputRef",ref:U,type:"file",accept:"image/png",onChange:X},null,544),o("button",{type:"button",class:"ghost",onClick:J,disabled:!s.value.penlightSprite}," Clear Image ",8,Fe)]),e[19]||(e[19]=o("p",{class:"hint"},"PNG only. Resized to 256Ã—256 client-side.",-1))])]),o("div",Be,[e[22]||(e[22]=o("label",{class:"label"},"Disallow Duplicate Users",-1)),o("div",Le,[o("label",He,[o("input",{type:"checkbox",checked:s.value.duplicateUsers,onChange:e[8]||(e[8]=l=>ee(l.target.checked))},null,40,Oe),e[21]||(e[21]=o("span",{class:"slider"},null,-1))])])]),o("div",Ze,[e[23]||(e[23]=o("label",{class:"label",for:"dupThresh"},"Duplication Threshold",-1)),o("div",je,[o("input",{id:"dupThresh",type:"number",min:"1",max:"100",value:s.value.duplicationThreshold,onInput:e[9]||(e[9]=l=>te(l.target.value))},null,40,qe)])]),o("div",ze,[e[24]||(e[24]=o("label",{class:"label",for:"maxConc"},"Max Concurrent",-1)),o("div",Ge,[o("input",{id:"maxConc",type:"number",min:"1",value:s.value.maxConcurrent,onInput:e[10]||(e[10]=l=>oe(l.target.value))},null,40,Qe)])])]))}},Xe=L(We,[["__scopeId","data-v-a3b2fdb2"]]),Je={class:"create-room-view"},Ke={key:1,style:{color:"crimson"}},Ye={__name:"CreateRoomView",setup(M){ce(),u(""),u(""),u(!1);const _=u(""),f=H({name:"a room",password:"",themeColor:"00ABAE",showCode:"bottom-left",penColors:[],penlightSprite:null,duplicateUsers:!0,duplicationThreshold:10,maxConcurrent:100});return g(f,V=>{}),(V,s)=>(r(),i("div",Je,[de(Xe,{modelValue:f,"onUpdate:modelValue":s[0]||(s[0]=h=>f=h)},null,8,["modelValue"]),p("",!0),_.value?(r(),i("p",Ke,w(_.value),1)):p("",!0)]))}},tt=L(Ye,[["__scopeId","data-v-f7888e24"]]);export{tt as default};
