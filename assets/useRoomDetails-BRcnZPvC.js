import{_ as H,p as $,r as B,w as K,s as V,o as J,c as W,b as U,d as P,l as X,F as Y,y as O,g as R,m as Q,u as Z}from"./index-CCQZgtHY.js";function ee(){const o=new Map;function c(){o.clear()}function v(n){if(!n)return;const t=`${n}::`;for(const u of o.keys())u.startsWith(t)&&o.delete(u)}function d(n){return new Promise((t,u)=>{const l=new Image;l.crossOrigin="anonymous",l.decoding="async",l.onload=()=>t(l),l.onerror=r=>u(new Error("Failed to load image: "+n)),l.src=n})}function h(n){const u=document.createElement("canvas");u.width=256,u.height=256;const l=u.getContext("2d",{willReadFrequently:!0});return l.drawImage(n,0,0,256,256),{canvas:u,ctx:l}}function w(n){if(!n)return"#DDDDDD";let t=String(n).trim();return t[0]!=="#"&&(t="#"+t),t.length===4&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),/^#([0-9a-fA-F]{6})$/.test(t)?t.toUpperCase():"#DDDDDD"}function x(n){const t=parseInt(n.slice(1),16);return{r:t>>16&255,g:t>>8&255,b:t&255}}function m(n,t,u,l,r){const e=1-r;return{r:Math.round(n*e+l.r*r),g:Math.round(t*e+l.g*r),b:Math.round(u*e+l.b*r)}}function k(n,t,u){const{width:l,height:r,data:e}=n;let s=!1;const a=new ImageData(l,r),p=a.data,b=0,i=255,y=0,j=Math.max(0,Number.isFinite(t)?t:0);for(let f=0;f<e.length;f+=4){const M=e[f],D=e[f+1],S=e[f+2],A=e[f+3];if(A===0)continue;const E=M-b,L=D-i,q=S-y,T=Math.sqrt(E*E+L*L+q*q);let F=0;if(M===0&&D===255&&S===0&&(s=!0),j===0?M===0&&D===255&&S===0&&(F=1):T<=j&&(F=1-T/j),F>0){const G=Math.round(A*F);p[f]=255,p[f+1]=255,p[f+2]=255,p[f+3]=G;const _=m(M,D,S,u,F);e[f]=_.r,e[f+1]=_.g,e[f+2]=_.b}}return{foundGreen:s,editedImageData:n,maskImageData:s?a:null}}function g(n){const t=document.createElement("canvas");return t.width=n.width,t.height=n.height,t.getContext("2d").putImageData(n,0,0),t.toDataURL("image/png")}function z(n,t,u=0,l="#DDDDDD"){if(!n||!t)return Promise.reject(new Error("getPenImages(roomCode, spriteSrc) requires both parameters."));const r=w(l),e=`${n}::${t}::${u}::${r}`;if(o.has(e))return o.get(e);const s=(async()=>{const a=await d(t),{canvas:p,ctx:b}=h(a),i=b.getImageData(0,0,p.width,p.height),y=x(r),{foundGreen:j,editedImageData:f,maskImageData:M}=k(i,u,y);b.putImageData(f,0,0);const D=p.toDataURL("image/png"),S=M?g(M):null;return{maskingMode:!!j,penImage:D,penMask:S}})().catch(a=>{throw o.delete(e),a});return o.set(e,s),s}return{getPenImages:z,clearPenMaskCache:c,clearRoomCache:v}}var I={exports:{}},te=I.exports,N;function ae(){return N||(N=1,(function(o,c){(function(v,d){o.exports=d()})(te,(()=>{return v={380:(h,w,x)=>{function m(r){return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(r)}function k(r){return(function(e){if(Array.isArray(e))return g(e)})(r)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(r)||(function(e,s){if(e){if(typeof e=="string")return g(e,s);var a=Object.prototype.toString.call(e).slice(8,-1);return a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set"?Array.from(e):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,s):void 0}})(r)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function g(r,e){(e==null||e>r.length)&&(e=r.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=r[s];return a}function z(r,e){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter((function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable}))),s.push.apply(s,a)}return s}function n(r){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?z(Object(s),!0).forEach((function(a){t(r,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):z(Object(s)).forEach((function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))}))}return r}function t(r,e,s){return(e=(function(a){var p=(function(b,i){if(m(b)!=="object"||b===null)return b;var y=b[Symbol.toPrimitive];if(y!==void 0){var j=y.call(b,"string");if(m(j)!=="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(b)})(a);return m(p)==="symbol"?p:String(p)})(e))in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}var u=x(554);function l(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s={placeholder:"*",caseSensitive:!1,wholeWordsOnly:!0,exceptions:[],keepFirstAndLastChar:!1,customReplacement:null,replacePartialWords:!1,includePunctuation:!1,minimumWordLength:1,customMatch:null,customBadWords:[]},a=n(n({},s),e),p=[].concat(k(u),k(a.customBadWords)).map((function(i){return i.replace(/\*/g,"\\w+")})),b=new RegExp(p.join("|"),"g");return a.caseSensitive||(b=new RegExp(p.join("|"),"gi")),a.wholeWordsOnly&&(b=new RegExp("\\b(".concat(p.join("|"),")\\b"),"gi")),a.replacePartialWords&&(b=new RegExp(p.join("|"),"gi")),r.replace(b,(function(i){if(i.length<a.minimumWordLength||typeof a.customMatch=="function"&&!a.customMatch(i)||a.exceptions.includes(i.toLowerCase()))return i;if(typeof a.customReplacement=="function")return a.customReplacement(i);if(a.keepFirstAndLastChar)return"".concat(i[0]).concat(a.placeholder.repeat(i.length-2)).concat(i[i.length-1]);var y=a.placeholder.repeat(i.length);if(a.includePunctuation){var j=i[0],f=i[i.length-1];j.match(/[^\w\s]/)&&(y="".concat(j).concat(y.substring(1))),f.match(/[^\w\s]/)&&(y="".concat(y.substring(0,y.length-1)).concat(f))}return y}))}h.exports={clean:l,isProfane:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=l(r,e);return s!==r}}},554:h=>{h.exports=JSON.parse('["ahole","anus","ash0le","ash0les","asholes","ass","Ass Monkey","Assface","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","Biatch","bitch","bitches","Blow Job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","Carpet Muncher","cawk","cawks","Clit","cnts","cntz","cock","cockhead","cock-head","cocks","CockSucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagg0t","fagit","fags","fagz","faig","faigs","fart","flipping the bird","fuck","fucker","fuckin","fucking","fucks","Fudge Packer","fuk","Fukah","Fuken","fuker","Fukin","Fukk","Fukkah","Fukken","Fukker","Fukkin","g00k","God-damned","h00r","h0ar","h0re","hells","hoar","hoor","hoore","jackoff","jap","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","Lezzian","Lipshits","Lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","Motha Fucker","Motha Fuker","Motha Fukkah","Motha Fukker","Mother Fucker","Mother Fukah","Mother Fuker","Mother Fukkah","Mother Fukker","mother-fucker","Mutha Fucker","Mutha Fukah","Mutha Fuker","Mutha Fukkah","Mutha Fukker","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","packi","packie","packy","paki","pakie","paky","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","Phuc","Phuck","Phuk","Phuker","Phukker","polac","polack","polak","Poonani","pr1c","pr1ck","pr1k","pusse","pussee","pussy","puuke","puuker","qweir","recktum","rectum","retard","sadist","scank","schlong","screwing","semen","sex","sexy","Sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","Shitty","Shity","shitz","Shyt","Shyte","Shytty","Shyty","skanck","skank","skankee","skankey","skanks","Skanky","slag","slut","sluts","Slutty","slutz","son-of-a-bitch","tit","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","w0p","wh00r","wh0re","whore","xrated","xxx","b!+ch","bitch","blowjob","clit","arschloch","fuck","shit","ass","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cock","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat*","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","*damn","*dyke","*fuck*","*shit*","@$$","amcik","andskota","arse*","assrammer","ayir","bi7ch","bitch*","bollock*","breasts","butt-pirate","cabron","cazzo","chraa","chuj","Cock*","cunt*","d4mn","daygo","dego","dick*","dike*","dupa","dziwka","ejackulate","Ekrem*","Ekto","enculer","faen","fag*","fanculo","fanny","feces","feg","Felcher","ficken","fitt*","Flikker","foreskin","Fotze","Fu*","fuk*","futkretzn","gook","guiena","h0r","h4x0r","hell","helvete","hoer*","honkey","Huevon","hui","injun","jizz","kanker*","kike","klootzak","kraut","knulle","kuk","kuksuger","Kurac","kurwa","kusi*","kyrpa*","lesbo","mamhoon","masturbat*","merd*","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger*","orospu","paska*","perse","picka","pierdol*","pillu*","pimmel","piss*","pizda","poontsee","poop","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef*","rautenberg","schaffer","scheiss*","schlampe","schmuck","screw","sh!t*","sharmuta","sharmute","shipal","shiz","skribz","skurwysyn","sphencter","spic","spierdalaj","splooge","suka","b00b*","testicle*","titt*","twat","vittu","wank*","wetback*","wichser","wop*","yed","zabourah"]')}},d={},(function h(w){var x=d[w];if(x!==void 0)return x.exports;var m=d[w]={exports:{}};return v[w](m,m.exports,h),m.exports})(380);var v,d}))})(I)),I.exports}var re=ae();function ne(o){if(!o||typeof o!="string")return o;let c=re.clean(o);const v=16;return c.length>v&&(c=c.slice(0,v)),c.replace(/\*/g,"â–ˆ")}const se=["src"],oe={class:"glow-wrapper blur20"},ie={class:"glow-wrapper blur3"},ce={__name:"PenLight",props:{roomDetails:{type:Object,required:!0},color:{type:String,required:!0},opacity:{type:Number,default:1},penTransform:{type:Object,required:!0},penSize:{type:Number,default:256,required:!1},nickName:{type:String,default:"anonymous",required:!1},smoothMotion:{type:Boolean,default:!1,required:!1}},setup(o){const c=o,v=$(()=>ne(c.nickName)),d=B(!0),h=B(!1),{getPenImages:w}=ee();K(()=>c.color,g=>{d.value=!1,setTimeout(()=>{d.value=!0},100)},{immediate:!0});const x=$(()=>{const g=c.roomDetails?.penlightSprite;return g?`${g}`:"/img/default_light.png"}),m=$(()=>{const g=c.penSize,z=c.penTransform.x,n=c.penTransform.y,t=c.penTransform.theta;return{left:`${z}px`,top:`${n}px`,width:`${g}px`,height:`${g}px`,transform:`translate(-50%, -80%) rotate(${t}deg)`,opacity:c.opacity,"--beam-color":`#${c.color}`}}),k=V(null);return J(async()=>{const g=c.roomDetails.code;k.value=await w(g,x.value,255),h.value=k.value?.maskingMode||!1}),(g,z)=>(U(),W("div",{class:R(["pen",{"use-motion-smoothing":o.smoothMotion}]),style:O(m.value),role:"img"},[P("img",{class:"pen-img",src:h.value?k.value.penImage:x.value,alt:"",draggable:"false"},null,8,se),d.value?(U(),W(Y,{key:0},[P("div",oe,[P("div",{class:R(["glow",{"mask-mode":h.value}]),style:O(h.value?{"-webkit-mask-image":`url(${k.value.penMask})`,"mask-image":`url(${k.value.penMask})`}:{})},null,6)]),P("div",ie,[P("div",{class:R(["glow",{"mask-mode":h.value}]),style:O(h.value?{"-webkit-mask-image":`url(${k.value.penMask})`,"mask-image":`url(${k.value.penMask})`}:{})},null,6)])],64)):X("",!0),P("div",{class:"pen-name",style:O({transform:`translateX(-50%) rotate(${-o.penTransform.theta}deg)`})},Q(v.value),5)],6))}},le=H(ce,[["__scopeId","data-v-92a6a84d"]]),C=new Map;async function pe(o=!1,c={}){const d=Z().params.room_code,h=Array.isArray(d)?d[0]:typeof d=="string"?d:void 0;if(!h)return null;const{signal:w,timeoutMs:x=8e3}=c,m=h;if(o&&C.has(m))return C.get(m);const k=new AbortController,g=setTimeout(()=>k.abort(),x);w&&(w.aborted?k.abort():w.addEventListener("abort",()=>k.abort(),{once:!0}));const z=(async()=>{try{const t=await fetch(`https://api.pen.lighting/rooms/${encodeURIComponent(h)}`,{headers:{Accept:"application/json"},signal:k.signal});return t.ok?await t.json():null}catch{return null}finally{clearTimeout(g)}})();o&&C.set(m,z);const n=await z;return n===null&&o&&C.delete(m),n}export{le as P,pe as u};
