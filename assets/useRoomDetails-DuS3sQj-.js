import{_ as U,p as $,r as N,s as G,o as H,c as K,b as J,d as P,y as O,g as R,m as X,u as V}from"./index-Ocpc1JRF.js";function Y(){const i=new Map;function p(){i.clear()}function w(n){if(!n)return;const a=`${n}::`;for(const u of i.keys())u.startsWith(a)&&i.delete(u)}function h(n){return new Promise((a,u)=>{const l=new Image;l.crossOrigin="anonymous",l.decoding="async",l.onload=()=>a(l),l.onerror=r=>u(new Error("Failed to load image: "+n)),l.src=n})}function d(n){const u=document.createElement("canvas");u.width=256,u.height=256;const l=u.getContext("2d",{willReadFrequently:!0});return l.drawImage(n,0,0,256,256),{canvas:u,ctx:l}}function b(n){if(!n)return"#DDDDDD";let a=String(n).trim();return a[0]!=="#"&&(a="#"+a),a.length===4&&(a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]),/^#([0-9a-fA-F]{6})$/.test(a)?a.toUpperCase():"#DDDDDD"}function x(n){const a=parseInt(n.slice(1),16);return{r:a>>16&255,g:a>>8&255,b:a&255}}function o(n,a,u,l,r){const e=1-r;return{r:Math.round(n*e+l.r*r),g:Math.round(a*e+l.g*r),b:Math.round(u*e+l.b*r)}}function f(n,a,u){const{width:l,height:r,data:e}=n;let s=!1;const t=new ImageData(l,r),m=t.data,g=0,c=255,y=0,v=Math.max(0,Number.isFinite(a)?a:0);for(let k=0;k<e.length;k+=4){const M=e[k],D=e[k+1],S=e[k+2],A=e[k+3];if(A===0)continue;const E=M-g,L=D-c,q=S-y,T=Math.sqrt(E*E+L*L+q*q);let F=0;if(M===0&&D===255&&S===0&&(s=!0),v===0?M===0&&D===255&&S===0&&(F=1):T<=v&&(F=1-T/v),F>0){const W=Math.round(A*F);m[k]=255,m[k+1]=255,m[k+2]=255,m[k+3]=W;const _=o(M,D,S,u,F);e[k]=_.r,e[k+1]=_.g,e[k+2]=_.b}}return{foundGreen:s,editedImageData:n,maskImageData:s?t:null}}function j(n){const a=document.createElement("canvas");return a.width=n.width,a.height=n.height,a.getContext("2d").putImageData(n,0,0),a.toDataURL("image/png")}function z(n,a,u=0,l="#DDDDDD"){if(!n||!a)return Promise.reject(new Error("getPenImages(roomCode, spriteSrc) requires both parameters."));const r=b(l),e=`${n}::${a}::${u}::${r}`;if(i.has(e))return i.get(e);const s=(async()=>{const t=await h(a),{canvas:m,ctx:g}=d(t),c=g.getImageData(0,0,m.width,m.height),y=x(r),{foundGreen:v,editedImageData:k,maskImageData:M}=f(c,u,y);g.putImageData(k,0,0);const D=m.toDataURL("image/png"),S=M?j(M):null;return{maskingMode:!!v,penImage:D,penMask:S}})().catch(t=>{throw i.delete(e),t});return i.set(e,s),s}return{getPenImages:z,clearPenMaskCache:p,clearRoomCache:w}}var C={exports:{}},Q=C.exports,B;function Z(){return B||(B=1,(function(i,p){(function(w,h){i.exports=h()})(Q,(()=>{return w={380:(d,b,x)=>{function o(r){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(r)}function f(r){return(function(e){if(Array.isArray(e))return j(e)})(r)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(r)||(function(e,s){if(e){if(typeof e=="string")return j(e,s);var t=Object.prototype.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?j(e,s):void 0}})(r)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function j(r,e){(e==null||e>r.length)&&(e=r.length);for(var s=0,t=new Array(e);s<e;s++)t[s]=r[s];return t}function z(r,e){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable}))),s.push.apply(s,t)}return s}function n(r){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?z(Object(s),!0).forEach((function(t){a(r,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):z(Object(s)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(s,t))}))}return r}function a(r,e,s){return(e=(function(t){var m=(function(g,c){if(o(g)!=="object"||g===null)return g;var y=g[Symbol.toPrimitive];if(y!==void 0){var v=y.call(g,"string");if(o(v)!=="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(g)})(t);return o(m)==="symbol"?m:String(m)})(e))in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}var u=x(554);function l(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s={placeholder:"*",caseSensitive:!1,wholeWordsOnly:!0,exceptions:[],keepFirstAndLastChar:!1,customReplacement:null,replacePartialWords:!1,includePunctuation:!1,minimumWordLength:1,customMatch:null,customBadWords:[]},t=n(n({},s),e),m=[].concat(f(u),f(t.customBadWords)).map((function(c){return c.replace(/\*/g,"\\w+")})),g=new RegExp(m.join("|"),"g");return t.caseSensitive||(g=new RegExp(m.join("|"),"gi")),t.wholeWordsOnly&&(g=new RegExp("\\b(".concat(m.join("|"),")\\b"),"gi")),t.replacePartialWords&&(g=new RegExp(m.join("|"),"gi")),r.replace(g,(function(c){if(c.length<t.minimumWordLength||typeof t.customMatch=="function"&&!t.customMatch(c)||t.exceptions.includes(c.toLowerCase()))return c;if(typeof t.customReplacement=="function")return t.customReplacement(c);if(t.keepFirstAndLastChar)return"".concat(c[0]).concat(t.placeholder.repeat(c.length-2)).concat(c[c.length-1]);var y=t.placeholder.repeat(c.length);if(t.includePunctuation){var v=c[0],k=c[c.length-1];v.match(/[^\w\s]/)&&(y="".concat(v).concat(y.substring(1))),k.match(/[^\w\s]/)&&(y="".concat(y.substring(0,y.length-1)).concat(k))}return y}))}d.exports={clean:l,isProfane:function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=l(r,e);return s!==r}}},554:d=>{d.exports=JSON.parse('["ahole","anus","ash0le","ash0les","asholes","ass","Ass Monkey","Assface","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","Biatch","bitch","bitches","Blow Job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","Carpet Muncher","cawk","cawks","Clit","cnts","cntz","cock","cockhead","cock-head","cocks","CockSucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagg0t","fagit","fags","fagz","faig","faigs","fart","flipping the bird","fuck","fucker","fuckin","fucking","fucks","Fudge Packer","fuk","Fukah","Fuken","fuker","Fukin","Fukk","Fukkah","Fukken","Fukker","Fukkin","g00k","God-damned","h00r","h0ar","h0re","hells","hoar","hoor","hoore","jackoff","jap","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","Lezzian","Lipshits","Lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","Motha Fucker","Motha Fuker","Motha Fukkah","Motha Fukker","Mother Fucker","Mother Fukah","Mother Fuker","Mother Fukkah","Mother Fukker","mother-fucker","Mutha Fucker","Mutha Fukah","Mutha Fuker","Mutha Fukkah","Mutha Fukker","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","packi","packie","packy","paki","pakie","paky","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","Phuc","Phuck","Phuk","Phuker","Phukker","polac","polack","polak","Poonani","pr1c","pr1ck","pr1k","pusse","pussee","pussy","puuke","puuker","qweir","recktum","rectum","retard","sadist","scank","schlong","screwing","semen","sex","sexy","Sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","Shitty","Shity","shitz","Shyt","Shyte","Shytty","Shyty","skanck","skank","skankee","skankey","skanks","Skanky","slag","slut","sluts","Slutty","slutz","son-of-a-bitch","tit","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","w0p","wh00r","wh0re","whore","xrated","xxx","b!+ch","bitch","blowjob","clit","arschloch","fuck","shit","ass","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cock","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat*","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","*damn","*dyke","*fuck*","*shit*","@$$","amcik","andskota","arse*","assrammer","ayir","bi7ch","bitch*","bollock*","breasts","butt-pirate","cabron","cazzo","chraa","chuj","Cock*","cunt*","d4mn","daygo","dego","dick*","dike*","dupa","dziwka","ejackulate","Ekrem*","Ekto","enculer","faen","fag*","fanculo","fanny","feces","feg","Felcher","ficken","fitt*","Flikker","foreskin","Fotze","Fu*","fuk*","futkretzn","gook","guiena","h0r","h4x0r","hell","helvete","hoer*","honkey","Huevon","hui","injun","jizz","kanker*","kike","klootzak","kraut","knulle","kuk","kuksuger","Kurac","kurwa","kusi*","kyrpa*","lesbo","mamhoon","masturbat*","merd*","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger*","orospu","paska*","perse","picka","pierdol*","pillu*","pimmel","piss*","pizda","poontsee","poop","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef*","rautenberg","schaffer","scheiss*","schlampe","schmuck","screw","sh!t*","sharmuta","sharmute","shipal","shiz","skribz","skurwysyn","sphencter","spic","spierdalaj","splooge","suka","b00b*","testicle*","titt*","twat","vittu","wank*","wetback*","wichser","wop*","yed","zabourah"]')}},h={},(function d(b){var x=h[b];if(x!==void 0)return x.exports;var o=h[b]={exports:{}};return w[b](o,o.exports,d),o.exports})(380);var w,h}))})(C)),C.exports}var ee=Z();function te(i){if(!i||typeof i!="string")return i;let p=ee.clean(i);const w=16;return p.length>w&&(p=p.slice(0,w)),p.replace(/\*/g,"â–ˆ")}const ae=["src"],re={class:"glow-wrapper blur20"},ne={class:"glow-wrapper blur3"},se={__name:"PenLight",props:{roomDetails:{type:Object,required:!0},color:{type:String,required:!0},opacity:{type:Number,default:1},penTransform:{type:Object,required:!0},penSize:{type:Number,default:256,required:!1},nickName:{type:String,default:"anonymous",required:!1},smoothMotion:{type:Boolean,default:!1,required:!1}},setup(i){const p=i,w=$(()=>te(p.nickName)),h=N(!1),{getPenImages:d}=Y(),b=$(()=>{const f=p.roomDetails?.penlightSprite;return f?`${f}`:"/img/default_light.png"}),x=$(()=>{const f=p.penSize,j=p.penTransform.x,z=p.penTransform.y,n=p.penTransform.theta;return{left:`${j}px`,top:`${z}px`,width:`${f}px`,height:`${f}px`,transform:`translate(-50%, -80%) rotate(${n}deg)`,opacity:p.opacity,"--beam-color":`#${p.color}`}}),o=G(null);return H(async()=>{const f=p.roomDetails.code;o.value=await d(f,b.value,255),h.value=o.value?.maskingMode||!1}),(f,j)=>(J(),K("div",{class:R(["pen",{"use-motion-smoothing":i.smoothMotion}]),style:O(x.value),role:"img"},[P("img",{class:"pen-img",src:h.value?o.value.penImage:b.value,alt:"",draggable:"false"},null,8,ae),P("div",re,[P("div",{class:R(["glow",{"mask-mode":h.value}]),style:O(h.value?{"-webkit-mask-image":`url(${o.value.penMask})`,"mask-image":`url(${o.value.penMask})`}:{})},null,6)]),P("div",ne,[P("div",{class:R(["glow",{"mask-mode":h.value}]),style:O(h.value?{"-webkit-mask-image":`url(${o.value.penMask})`,"mask-image":`url(${o.value.penMask})`}:{})},null,6)]),P("div",{class:"pen-name",style:O({transform:`translateX(-50%) rotate(${-i.penTransform.theta}deg)`})},X(w.value),5)],6))}},ie=U(se,[["__scopeId","data-v-d1861b54"]]),I=new Map;async function ce(i=!1,p={}){const h=V().params.room_code,d=Array.isArray(h)?h[0]:typeof h=="string"?h:void 0;if(!d)return null;const{signal:b,timeoutMs:x=8e3}=p,o=d;if(i&&I.has(o))return I.get(o);const f=new AbortController,j=setTimeout(()=>f.abort(),x);b&&(b.aborted?f.abort():b.addEventListener("abort",()=>f.abort(),{once:!0}));const z=(async()=>{try{const a=await fetch(`https://api.pen.lighting/rooms/${encodeURIComponent(d)}`,{headers:{Accept:"application/json"},signal:f.signal});return a.ok?await a.json():null}catch{return null}finally{clearTimeout(j)}})();i&&I.set(o,z);const n=await z;return n===null&&i&&I.delete(o),n}export{ie as P,ce as u};
