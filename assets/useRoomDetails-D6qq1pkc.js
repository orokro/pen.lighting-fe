import{_ as G,p as T,r as R,s as X,w as J,o as K,c as q,b as W,d as C,l as Y,F as Q,y as O,g as A,m as Z,a as ee,u as te}from"./index-qxyoSWbH.js";function ae(){const l=new Map;function v(){l.clear()}function h(o){if(!o)return;const r=`${o}::`;for(const u of l.keys())u.startsWith(r)&&l.delete(u)}function d(o){return new Promise((r,u)=>{const n=new Image;n.crossOrigin="anonymous",n.decoding="async",n.onload=()=>r(n),n.onerror=e=>u(new Error("Failed to load image: "+o)),n.src=o})}function b(o){const u=document.createElement("canvas");u.width=256,u.height=256;const n=u.getContext("2d",{willReadFrequently:!0});return n.drawImage(o,0,0,256,256),{canvas:u,ctx:n}}function f(o){if(!o)return"#DDDDDD";let r=String(o).trim();return r[0]!=="#"&&(r="#"+r),r.length===4&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),/^#([0-9a-fA-F]{6})$/.test(r)?r.toUpperCase():"#DDDDDD"}function j(o){const r=parseInt(o.slice(1),16);return{r:r>>16&255,g:r>>8&255,b:r&255}}function p(o,r,u,n,e){const a=1-e;return{r:Math.round(o*a+n.r*e),g:Math.round(r*a+n.g*e),b:Math.round(u*a+n.b*e)}}function k(o,r,u){const{width:n,height:e,data:a}=o;let t=!1;const m=new ImageData(n,e),c=m.data,s=0,g=255,M=0,D=Math.max(0,Number.isFinite(r)?r:0);for(let w=0;w<a.length;w+=4){const P=a[w],I=a[w+1],S=a[w+2],F=a[w+3];if(F===0)continue;const x=P-s,B=I-g,U=S-M,N=Math.sqrt(x*x+B*B+U*U);let _=0;if(P===0&&I===255&&S===0&&(t=!0),D===0?P===0&&I===255&&S===0&&(_=1):N<=D&&(_=1-N/D),_>0){const V=Math.round(F*_);c[w]=255,c[w+1]=255,c[w+2]=255,c[w+3]=V;const L=p(P,I,S,u,_);a[w]=L.r,a[w+1]=L.g,a[w+2]=L.b}}return{foundGreen:t,editedImageData:o,maskImageData:t?m:null}}function y(o){const r=document.createElement("canvas");return r.width=o.width,r.height=o.height,r.getContext("2d").putImageData(o,0,0),r.toDataURL("image/png")}function z(o){const{canvas:r,ctx:u}=b(o);return u.getImageData(0,0,r.width,r.height)}function i(o,r,u=0,n=!0,e="#DDDDDD"){if(!o||!r)return Promise.reject(new Error("getPenImages(roomCode, spriteSrc) requires both parameters."));const a=f(e),t=`${o}::${r}::${u}::${a}`;if(l.has(t))return l.get(t);const m=(async()=>{const c=await d(r),{canvas:s,ctx:g}=b(c),M=g.getImageData(0,0,s.width,s.height),D=j(a);let{foundGreen:w,editedImageData:P,maskImageData:I}=k(M,u,D),S=!1;n&&!I&&(I=z(await d("/img/default_mask.png")),S=!0),g.putImageData(P,0,0);const F=s.toDataURL("image/png"),x=I?y(I):null;return{maskingMode:!!w||S,penImage:F,penMask:x}})().catch(c=>{throw l.delete(t),c});return l.set(t,m),m}return{getPenImages:i,clearPenMaskCache:v,clearRoomCache:h}}var E={exports:{}},ne=E.exports,H;function re(){return H||(H=1,(function(l,v){(function(h,d){l.exports=d()})(ne,(()=>{return h={380:(b,f,j)=>{function p(n){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(n)}function k(n){return(function(e){if(Array.isArray(e))return y(e)})(n)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(n)||(function(e,a){if(e){if(typeof e=="string")return y(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?y(e,a):void 0}})(n)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function y(n,e){(e==null||e>n.length)&&(e=n.length);for(var a=0,t=new Array(e);a<e;a++)t[a]=n[a];return t}function z(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(m){return Object.getOwnPropertyDescriptor(n,m).enumerable}))),a.push.apply(a,t)}return a}function i(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?z(Object(a),!0).forEach((function(t){o(n,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))}))}return n}function o(n,e,a){return(e=(function(t){var m=(function(c,s){if(p(c)!=="object"||c===null)return c;var g=c[Symbol.toPrimitive];if(g!==void 0){var M=g.call(c,"string");if(p(M)!=="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)})(t);return p(m)==="symbol"?m:String(m)})(e))in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var r=j(554);function u(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a={placeholder:"*",caseSensitive:!1,wholeWordsOnly:!0,exceptions:[],keepFirstAndLastChar:!1,customReplacement:null,replacePartialWords:!1,includePunctuation:!1,minimumWordLength:1,customMatch:null,customBadWords:[]},t=i(i({},a),e),m=[].concat(k(r),k(t.customBadWords)).map((function(s){return s.replace(/\*/g,"\\w+")})),c=new RegExp(m.join("|"),"g");return t.caseSensitive||(c=new RegExp(m.join("|"),"gi")),t.wholeWordsOnly&&(c=new RegExp("\\b(".concat(m.join("|"),")\\b"),"gi")),t.replacePartialWords&&(c=new RegExp(m.join("|"),"gi")),n.replace(c,(function(s){if(s.length<t.minimumWordLength||typeof t.customMatch=="function"&&!t.customMatch(s)||t.exceptions.includes(s.toLowerCase()))return s;if(typeof t.customReplacement=="function")return t.customReplacement(s);if(t.keepFirstAndLastChar)return"".concat(s[0]).concat(t.placeholder.repeat(s.length-2)).concat(s[s.length-1]);var g=t.placeholder.repeat(s.length);if(t.includePunctuation){var M=s[0],D=s[s.length-1];M.match(/[^\w\s]/)&&(g="".concat(M).concat(g.substring(1))),D.match(/[^\w\s]/)&&(g="".concat(g.substring(0,g.length-1)).concat(D))}return g}))}b.exports={clean:u,isProfane:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=u(n,e);return a!==n}}},554:b=>{b.exports=JSON.parse('["ahole","anus","ash0le","ash0les","asholes","ass","Ass Monkey","Assface","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","Biatch","bitch","bitches","Blow Job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","Carpet Muncher","cawk","cawks","Clit","cnts","cntz","cock","cockhead","cock-head","cocks","CockSucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagg0t","fagit","fags","fagz","faig","faigs","fart","flipping the bird","fuck","fucker","fuckin","fucking","fucks","Fudge Packer","fuk","Fukah","Fuken","fuker","Fukin","Fukk","Fukkah","Fukken","Fukker","Fukkin","g00k","God-damned","h00r","h0ar","h0re","hells","hoar","hoor","hoore","jackoff","jap","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","Lezzian","Lipshits","Lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","Motha Fucker","Motha Fuker","Motha Fukkah","Motha Fukker","Mother Fucker","Mother Fukah","Mother Fuker","Mother Fukkah","Mother Fukker","mother-fucker","Mutha Fucker","Mutha Fukah","Mutha Fuker","Mutha Fukkah","Mutha Fukker","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","packi","packie","packy","paki","pakie","paky","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","Phuc","Phuck","Phuk","Phuker","Phukker","polac","polack","polak","Poonani","pr1c","pr1ck","pr1k","pusse","pussee","pussy","puuke","puuker","qweir","recktum","rectum","retard","sadist","scank","schlong","screwing","semen","sex","sexy","Sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","Shitty","Shity","shitz","Shyt","Shyte","Shytty","Shyty","skanck","skank","skankee","skankey","skanks","Skanky","slag","slut","sluts","Slutty","slutz","son-of-a-bitch","tit","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","w0p","wh00r","wh0re","whore","xrated","xxx","b!+ch","bitch","blowjob","clit","arschloch","fuck","shit","ass","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cock","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat*","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","*damn","*dyke","*fuck*","*shit*","@$$","amcik","andskota","arse*","assrammer","ayir","bi7ch","bitch*","bollock*","breasts","butt-pirate","cabron","cazzo","chraa","chuj","Cock*","cunt*","d4mn","daygo","dego","dick*","dike*","dupa","dziwka","ejackulate","Ekrem*","Ekto","enculer","faen","fag*","fanculo","fanny","feces","feg","Felcher","ficken","fitt*","Flikker","foreskin","Fotze","Fu*","fuk*","futkretzn","gook","guiena","h0r","h4x0r","hell","helvete","hoer*","honkey","Huevon","hui","injun","jizz","kanker*","kike","klootzak","kraut","knulle","kuk","kuksuger","Kurac","kurwa","kusi*","kyrpa*","lesbo","mamhoon","masturbat*","merd*","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger*","orospu","paska*","perse","picka","pierdol*","pillu*","pimmel","piss*","pizda","poontsee","poop","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef*","rautenberg","schaffer","scheiss*","schlampe","schmuck","screw","sh!t*","sharmuta","sharmute","shipal","shiz","skribz","skurwysyn","sphencter","spic","spierdalaj","splooge","suka","b00b*","testicle*","titt*","twat","vittu","wank*","wetback*","wichser","wop*","yed","zabourah"]')}},d={},(function b(f){var j=d[f];if(j!==void 0)return j.exports;var p=d[f]={exports:{}};return h[f](p,p.exports,b),p.exports})(380);var h,d}))})(E)),E.exports}var oe=re();function se(l){if(!l||typeof l!="string")return l;let v=oe.clean(l);const h=16;return v.length>h&&(v=v.slice(0,h)),v.replace(/\*/g,"█")}const ie=["src"],ce={class:"glow-wrapper blur20"},ue={class:"glow-wrapper blur3"},le={__name:"PenLight",props:{roomDetails:{type:Object,required:!0},color:{type:String,required:!0},opacity:{type:Number,default:1},penTransform:{type:Object,required:!0},penSize:{type:Number,default:256,required:!1},nickName:{type:String,default:"anonymous",required:!1},smoothMotion:{type:Boolean,default:!1,required:!1}},setup(l,{expose:v}){const h=l,d=T(()=>se(h.nickName)),b=R(!0),f=R(!1),{getPenImages:j}=ae(),p=R(null),k=X(null),y=R(null);let z="",i=null;J(()=>h.color,e=>{b.value=!1,setTimeout(()=>{b.value=!0},100)},{immediate:!0});const o=T(()=>{const e=h.roomDetails?.penlightSprite;return e?`${e}`:"/img/default_light.png"}),r=T(()=>{const e=h.penSize,a=h.penTransform.x,t=h.penTransform.y,m=h.penTransform.theta;return{left:`${a}px`,top:`${t}px`,width:`${e}px`,height:`${e}px`,transform:`translate(-50%, -80%) rotate(${m}deg)`,opacity:h.opacity,"--beam-color":`#${h.color}`}});K(async()=>{const e=h.roomDetails.code;k.value=await j(e,o.value,255),f.value=k.value?.maskingMode||!1,f.value&&k.value?.penMask&&(y.value=new Image,y.value.src=k.value.penMask,await new Promise((a,t)=>{y.value.onload=()=>a(!0),y.value.onerror=()=>t(!1)}))});function u(e,a){if(a===z&&i!=null)return i;if(!(e instanceof HTMLImageElement))throw new TypeError("colorImage: expected HTMLImageElement");if(!e.complete||e.naturalWidth===0)throw new Error("colorImage: image not loaded");const t=e.naturalWidth,m=e.naturalHeight,c=document.createElement("canvas");c.width=t,c.height=m;const s=c.getContext("2d");s.clearRect(0,0,t,m),s.drawImage(e,0,0,t,m),s.globalCompositeOperation="source-in",s.fillStyle=a,s.fillRect(0,0,t,m),s.globalCompositeOperation="source-over";const g=new Image;return g.src=c.toDataURL(),i=g,z=a,g}function n(e){if(!p.value)return;const a=p.value,t=a.getBoundingClientRect(),c=window.getComputedStyle(a).transform,{penSize:s,color:g}=h;if(y.value==null)return;const M=u(y.value,`#${g}`);if(!c||c==="none"){e.strokeStyle=`#${g}`,e.lineWidth=1,e.strokeRect(t.left,t.top,t.width,t.height);return}const D=c.match(/^matrix\((.+)\)$/);if(!D){console.warn("No valid matrix:",c),e.strokeStyle=`#${g}`,e.strokeRect(t.left,t.top,t.width,t.height);return}const[w,P]=D[1].split(",").map(Number),I=Math.atan2(P,w),S=t.left+t.width/2,F=t.top+t.height/2,x=s/2;M&&M.complete&&(e.save(),e.translate(S,F),e.rotate(I),e.drawImage(M,-x,-x,s,s),e.restore())}return v({drawPenTrail:n}),(e,a)=>(W(),q("div",{ref_key:"rootEl",ref:p,class:A(["pen",{"use-motion-smoothing":l.smoothMotion}]),style:O(r.value),role:"img"},[C("img",{class:"pen-img",src:f.value?k.value.penImage:o.value,alt:"",draggable:"false"},null,8,ie),b.value?(W(),q(Q,{key:0},[C("div",ce,[C("div",{class:A(["glow",{"mask-mode":f.value}]),style:O(f.value?{"-webkit-mask-image":`url(${k.value.penMask})`,"mask-image":`url(${k.value.penMask})`}:{})},null,6)]),C("div",ue,[C("div",{class:A(["glow",{"mask-mode":f.value}]),style:O(f.value?{"-webkit-mask-image":`url(${k.value.penMask})`,"mask-image":`url(${k.value.penMask})`}:{})},null,6)])],64)):Y("",!0),C("div",{class:"pen-name",style:O({transform:`translateX(-50%) rotate(${-l.penTransform.theta}deg)`})},Z(d.value),5)],6))}},fe=G(le,[["__scopeId","data-v-70e8bbbd"]]),he={__name:"PenLightTrails",props:{penlightRefs:{type:Array,required:!0}},setup(l,{expose:v}){const h=l,d=R(null);let b=null,f=null,j=0;function p(i){const{width:o,height:r}=i.canvas;i.save(),i.globalCompositeOperation="destination-in",i.globalAlpha=.98,i.fillRect(0,0,o,r),i.restore(),j++%10===0&&k(i,27),h.penlightRefs?.length&&h.penlightRefs.forEach(u=>{u?.drawPenTrail(i)})}function k(i,o=10){const{width:r,height:u}=i.canvas,n=i.getImageData(0,0,r,u),e=n.data;for(let a=3;a<e.length;a+=4)e[a]<o&&(e[a]=0);i.putImageData(n,0,0)}function y(){b&&(p(b),f=requestAnimationFrame(y))}K(()=>{const i=d.value;i&&(i.width=window.innerWidth,i.height=window.innerHeight,b=i.getContext("2d",{willReadFrequently:!0}),y(),window.addEventListener("resize",z))}),ee(()=>{f&&cancelAnimationFrame(f),window.removeEventListener("resize",z)});function z(){d.value&&(d.value.width=window.innerWidth,d.value.height=window.innerHeight)}return v({drawTrail:p}),(i,o)=>(W(),q("canvas",{ref_key:"trailCanvas",ref:d,class:"trail-canvas"},null,512))}},ge=G(he,[["__scopeId","data-v-5934fd7a"]]),$=new Map,me="https://dev.api.pen.lighting";async function de(l=!1,v={}){const d=te().params.room_code,b=Array.isArray(d)?d[0]:typeof d=="string"?d:void 0;if(!b)return null;const{signal:f,timeoutMs:j=8e3}=v,p=b;if(l&&$.has(p))return $.get(p);const k=new AbortController,y=setTimeout(()=>k.abort(),j);f&&(f.aborted?k.abort():f.addEventListener("abort",()=>k.abort(),{once:!0}));const z=(async()=>{try{const o=await fetch(`${me}/rooms/${encodeURIComponent(b)}`,{headers:{Accept:"application/json"},signal:k.signal});return o.ok?await o.json():null}catch{return null}finally{clearTimeout(y)}})();l&&$.set(p,z);const i=await z;return i===null&&l&&$.delete(p),i}export{ge as P,fe as a,de as u};
